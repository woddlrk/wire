<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="utf-8" />
    <title>Swiper demo</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1" />
    <!-- Link Swiper's CSS -->
    <style>
        @import url(https://qwerewqwerew.github.io/source/style/reset.css);
    </style>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css" />
    <!-- Demo styles -->
    <style>
        html,
        body {
            position: relative;
            height: 100%;
        }

        section.vh100 {
            width: 100%;
            height: 100vh;
            background: #ccc;
        }

        .swiper {
            width: 100%;
            height: 100%;
        }

        .swiper-slide {
            text-align: center;
            font-size: 18px;
            display: flex;
            justify-content: center;
            align-items: center;
        }
    </style>
</head>

<body>
    <!--  .swiper.vertical>swiper-wrapper>(a.swiper-slide)*3+section.swiper.section_All.swiper+a.swiper-slide -->
    <div class="swiper verticals">
        <div class="swiper-wrapper">
            <section class="vh100 swiper-slide"> 1 </section>
            <section class="vh100 swiper-slide"> 2 </section>
            <section class="vh100 swiper-slide"> 3 </section>
            <section class="swiper horizontals swiper-slide">
                <div class="swiper-wrapper">
                    <div class="swiper-slide" data-hash="slide1">Slide 1</div>
                    <div class="swiper-slide" data-hash="slide2">Slide 2</div>
                    <div class="swiper-slide" data-hash="slide3">Slide 3</div>
                    <div class="swiper-slide" data-hash="slide4">Slide 4</div>
                </div>
                <div class="swiper-pagination"></div>
            </section>
            <section class="vh100 swiper-slide"> 5 </section>
        </div>
    </div>
    <!-- Swiper JS -->
    <script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>
    <!-- Initialize Swiper -->
    <script>
        // 전역 변수
        let verticalSwiper;
        let horizontalSwiper;

        // 상수 정의
        const HORIZONTAL_SECTION_INDEX = 3;
        const SECTION_5_INDEX = 4;
        const SECTION_3_INDEX = 2;

        // 수평 스와이퍼 초기화
        function initHorizontalSwiper() {
            horizontalSwiper = new Swiper(".horizontals", {
                direction: "horizontal",
                slidesPerView: 1,
                spaceBetween: 30,
                mousewheel: true,
                pagination: {
                    el: ".swiper-pagination",
                    clickable: true,
                },
                hashNavigation: {
                    watchState: true,
                },
                on: {
                    reachEnd: handleHorizontalReachEnd,
                    reachBeginning: handleHorizontalReachBeginning,
                    transitionEnd: handleHorizontalTransitionEnd
                }
            });
        }

        // 수직 스와이퍼 초기화
        function initVerticalSwiper() {
            verticalSwiper = new Swiper(".verticals", {
                direction: "vertical",
                slidesPerView: 1,
                mousewheel: true,
                on: {
                    slideChange: handleVerticalSlideChange,
                    slideChangeTransitionStart: handleVerticalTransitionStart,
                    slideChangeTransitionEnd: handleVerticalTransitionEnd
                }
            });
        }

        // 수평 스와이퍼 이벤트 핸들러
        function handleHorizontalReachEnd() {
            horizontalSwiper.canMoveToNext = true;
        }

        function handleHorizontalReachBeginning() {
            horizontalSwiper.canMoveToPrev = true;
        }

        function handleHorizontalTransitionEnd() {
            if (horizontalSwiper.canMoveToNext && horizontalSwiper.isEnd) {
                enableVerticalScrollAndMove(function () {
                    verticalSwiper.slideNext();
                });
                horizontalSwiper.canMoveToNext = false;
            }

            if (horizontalSwiper.canMoveToPrev && horizontalSwiper.isBeginning) {
                enableVerticalScrollAndMove(function () {
                    verticalSwiper.slideTo(SECTION_3_INDEX);
                });
                horizontalSwiper.canMoveToPrev = false;
            }
        }

        // 수직 스와이퍼 이벤트 핸들러
        function handleVerticalSlideChange() {
            console.log('Vertical slide changed to:', this.activeIndex);

            if (this.activeIndex === HORIZONTAL_SECTION_INDEX) {
                disableVerticalScroll();
                resetHorizontalSlider(this.previousIndex);
            } else {
                enableVerticalScroll();
                console.log('Vertical scroll enabled for section:', this.activeIndex);
            }
        }

        function handleVerticalTransitionStart() {
            console.log('Transition start: from', this.previousIndex, 'to', this.activeIndex);

            if (isMovingFromSection5ToHorizontal(this)) {
                disableVerticalScroll();
                setHorizontalToLastSlide();
            }
        }

        function handleVerticalTransitionEnd() {
            if (this.activeIndex === HORIZONTAL_SECTION_INDEX) {
                setTimeout(function () {
                    if (verticalSwiper.previousIndex !== SECTION_5_INDEX) {
                        horizontalSwiper.update();
                    }
                }, 100);
            }
        }

        // 유틸리티 함수
        function isMovingFromSection5ToHorizontal(swiper) {
            return swiper.previousIndex === SECTION_5_INDEX &&
                swiper.activeIndex === HORIZONTAL_SECTION_INDEX;
        }

        function disableVerticalScroll() {
            verticalSwiper.allowTouchMove = false;
            verticalSwiper.mousewheel.disable();
        }

        function enableVerticalScroll() {
            verticalSwiper.allowTouchMove = true;
            verticalSwiper.mousewheel.enable();
        }

        function enableVerticalScrollAndMove(moveFunction) {
            enableVerticalScroll();
            setTimeout(moveFunction, 300);
        }

        function resetHorizontalSlider(previousIndex) {
            if (previousIndex !== SECTION_5_INDEX) {
                setTimeout(function () {
                    horizontalSwiper.slideTo(0, 0);
                }, 50);
            }
        }

        function setHorizontalToLastSlide() {
            setTimeout(function () {
                horizontalSwiper.slideTo(3, 0); // 마지막 슬라이드로 이동
            }, 100);
        }

        // 스와이퍼 초기화 실행
        initHorizontalSwiper();
        initVerticalSwiper();
    </script>
</body>

</html>